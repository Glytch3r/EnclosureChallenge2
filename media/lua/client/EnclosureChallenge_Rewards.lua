--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       		 Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							  |
|                       		 Discord:    Glytch3r#1337 / glytch3r															  |
|                       		 Support:    https://ko-fi.com/glytch3r														 	  |
|_________________________________________________________________________________________________________________________________|
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████-]]

----------------------------------------------------------------------------------------------------------------------------------

EnclosureChallenge = EnclosureChallenge or {}

function EnclosureChallenge.getRewardChoice()
    local pl = getPlayer()
    if not pl then return 0 end

    local md = pl:getModData()
    md.EnclosureChallenge = md.EnclosureChallenge or {}
    return md.EnclosureChallenge.RewardChoice or 0
end

function EnclosureChallenge.setRewardChoice(int)
    local pl = getPlayer()
    if not pl then return end

    local md = pl:getModData()
    md.EnclosureChallenge = md.EnclosureChallenge or {}
    md.EnclosureChallenge.RewardChoice = int or 0
end

function EnclosureChallenge.parseItems(int)
	int = int or 0
	local tab = {}

	if int == 0 then
		for i = 1, 14 do
			local title = EnclosureChallenge.getRewardTitle(i)
			if title and title ~= "" then
				local lootStr = EnclosureChallenge.getRewardList(i)
				if lootStr and lootStr ~= '' then
					for item in string.gmatch(lootStr, "([^;]+)") do
						table.insert(tab, item)
					end
				end
			end
		end
	else
		local title = EnclosureChallenge.getRewardTitle(int)
		if title and title ~= "" then
			local lootStr = EnclosureChallenge.getRewardList(int)
			if lootStr and lootStr ~= '' then
				for item in string.gmatch(lootStr, "([^;]+)") do
					table.insert(tab, item)
				end
			end
		end
	end

	return tab
end

function EnclosureChallenge.getRewardList(int)
    int = int or 0
    local varName = "EnclosureChallenge" .. tostring(int)
    if SandboxVars[varName] and SandboxVars[varName].Rewards then
        return SandboxVars[varName].Rewards
    end
    return ""
end

function EnclosureChallenge.getRewardTitle(int)
    int = int or 0
    if int == 0 then return "Random" end
    local varName = "EnclosureChallenge" .. tostring(int)
    if SandboxVars[varName] and SandboxVars[varName].RewardTitle then
        return SandboxVars[varName].RewardTitle
    end
    return ""
end

function EnclosureChallenge.getRewardChance(int)
    int = int or 0
    local varName = "EnclosureChallenge" .. tostring(int)
    if SandboxVars[varName] and SandboxVars[varName].RewardChance then
        return SandboxVars[varName].RewardChance
    end
    return 0
end
-----------------------            ---------------------------
function EnclosureChallenge.doReward()
	local int = EnclosureChallenge.getRewardChoice() or 0
	local pl = getPlayer()
	if not pl then return end
    getSoundManager():playUISound("GainExperienceLevel")

	local inv = pl:getInventory()
	local itemList = EnclosureChallenge.parseItems(int)
	if #itemList == 0 then return end

	local chance = (int == 0) and 100 or (EnclosureChallenge.getRewardChance(int) or 100)

	if EnclosureChallenge.doRoll(chance) then
		local randomItem = itemList[ZombRand(1, #itemList)]
		if randomItem then
			local title = EnclosureChallenge.getRewardTitle(int)

			pl:setHaloNote("Enclosure Challenge Reward:\n(" .. tostring(title) .. ") - " .. tostring(randomItem), 150, 250, 150, 900)
			inv:AddItem(randomItem)
			inv:setDrawDirty(true)
		end
	end

	ISInventoryPage.dirtyUI()
end

-----------------------            ---------------------------